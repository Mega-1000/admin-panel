<template>
  <table class="table">
    <thead>
    <tr>
      <th scope="col"></th>
      <th scope="col" class="text-center"></th>
      <th scope="col" class="text-center">Klient</th>
      <th scope="col" class="text-center">Konsultant</th>
      <th scope="col" class="text-center">Magazyn</th>
    </tr>
    </thead>
    <tbody>
    <tr>
      <th scope="row" rowspan="2" class="v-align-middle">Preferowana data nadania</th>
      <th scope="row">Od</th>
      <td class="text-center">{{ customerDates.shipment_date_from }}</td>
      <td class="text-center">{{ consultantDates.shipment_date_from }}</td>
      <td class="text-center">{{ warehouseDates.shipment_date_from }}</td>
    </tr>
    <tr>
      <th scope="row">Do</th>
      <td class="text-center">{{ customerDates.shipment_date_to }}</td>
      <td class="text-center">{{ consultantDates.shipment_date_to }}</td>
      <td class="text-center">{{ warehouseDates.shipment_date_to }}</td>
    </tr>
    <tr>
      <th scope="row" rowspan="2" class="v-align-middle">Preferowana data dostawy</th>
      <th scope="row">Od</th>
      <td class="text-center">{{ customerDates.delivery_date_from }}</td>
      <td class="text-center">{{ consultantDates.delivery_date_from }}</td>
      <td class="text-center">{{ warehouseDates.delivery_date_from }}</td>
    </tr>
    <tr>
      <th scope="row">Do</th>
      <td class="text-center">{{ customerDates.delivery_date_to }}</td>
      <td class="text-center">{{ consultantDates.delivery_date_to }}</td>
      <td class="text-center">{{ warehouseDates.delivery_date_to }}</td>
    </tr>
    <tr>
      <th scope="row" colspan="2" class="text-center">Akceptacja</th>
      <td class="text-center">
        <span :class="getGlyphiconClass(acceptance.customer)" class="glyphicon"></span>
      </td>
      <td class="text-center">
        <span :class="getGlyphiconClass(acceptance.consultant)" class="glyphicon"></span>
      </td>
      <td class="text-center">
        <span :class="getGlyphiconClass(acceptance.warehouse)" class="glyphicon"></span>
      </td>
    </tr>
    <tr>
      <th scope="row" colspan="2" class="text-center">Akcje</th>
      <td>
        <div class="row">
          <div class="btn-group mb-5" role="group">
            <button type="button" class="btn btn-sm btn-primary" :class="{ disabled: userType!=='customer'}"
                    :disabled="userType!=='customer'"
                    @click="$emit('modify','customer')">Modyfikuj
            </button>
            <button type="button" class="btn btn-sm btn-success" :class="{ disabled: !canAccept('customer')}"
                    :disabled="!canAccept('customer')"
                    @click="$emit('accept','customer')">Akceptuj
            </button>
          </div>
        </div>
      </td>
      <td>
        <div class="row text-center">
          <div class="btn-group" role="group">
            <button type="button" class="btn btn-sm btn-primary" :class="{ disabled: userType!=='consultant'}"
                    :disabled="userType !== 'consultant'"
                    @click="$emit('modify','consultant')">Modyfikuj
            </button>
            <button type="button" class="btn btn-sm btn-success" :class="{ disabled: !canAccept('consultant') }"
                    :disabled="!canAccept('consultant')"
                    @click="$emit('accept','consultant')">Akceptuj
            </button>
          </div>
        </div>
        <div class="row text-center mt-5" v-if="!acceptance.customer && canAcceptAsCustomer && !canAccept('warehouse')">
          <div class="btn-group" role="group">
            <button type="button" class="btn btn-sm btn-info"
                    @click="$emit('acceptAsCustomer')">Akceptuj w imieniu klienta
            </button>
          </div>
        </div>
      </td>
      <td>
        <div class="btn-group" role="group">
          <button type="button" class="btn btn-sm btn-primary" :class="{ disabled: userType!=='warehouse'}"
                  :disabled="userType!=='warehouse'"
                  @click="$emit('modify','warehouse')">Modyfikuj
          </button>
          <button type="button" class="btn btn-sm btn-success" :class="{ disabled: !canAccept('warehouse') }"
                  :disabled="!canAccept('warehouse')"
                  @click="$emit('accept','warehouse')">Akceptuj
          </button>
        </div>
      </td>
    </tr>
    </tbody>
  </table>
</template>
<script lang="ts">
import { Component, Prop, Vue } from 'vue-property-decorator'
import { Acceptance, Dates } from '@/types/OrdersTypes'

@Component({
  components: {}
})
export default class DatesTable extends Vue {
  @Prop() public orderId!: number
  @Prop() public userType!: string

  public get customerDates (): Dates {
    return this.$store?.getters['OrdersService/customerDates']
  }

  public get consultantDates (): Dates {
    return this.$store?.getters['OrdersService/consultantDates']
  }

  public get warehouseDates (): Dates {
    return this.$store?.getters['OrdersService/warehouseDates']
  }

  public get acceptance (): Acceptance {
    return console.log(this.$store?.getters['OrdersService/acceptance'])
  }

  public getGlyphiconClass (accept: boolean): string {
    return 'glyphicon-' + (accept ? 'ok text-success' : 'remove text-danger')
  }

  public canAccept (userType: string): boolean {
    if (userType === this.userType) {
      return false
    }
    const dates = this.$store?.getters['OrdersService/' + userType + 'Dates']
    return Object.values(dates).some(date => (date !== null))
  }

  public canAcceptAsCustomer (): boolean {
    if (this.userType === 'consultant') {
      const dates = this.$store?.getters['OrdersService/consultantDates']
      return Object.values(dates).some(date => (date !== null))
    } else {
      return false
    }
  }
}
</script>
<style scoped lang="scss">
  @import "@/assets/styles/main";

  .v-align-middle {
    vertical-align: middle;
  }

  .mb-5 {
    margin-bottom: 5px;
  }

  .mt-5 {
    margin-top: 5px;
  }
</style>
